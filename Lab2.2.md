Task 2.1
> db.orders.insert({"order_number":1111, "date":ISODate("2021-06-18"), "total_sum":1000, "customer":{"name":"Katerina", "surname":"Burbela", "phone_numbers":[102938, 019283], "address":"PTI, Peremohy ave. 27, Kyiv, UA"}, "payment":{"card_owner":"Katerina Burbela", "cardID":11111111}, "order_items_id":[{"$ref":"test", "$id":ObjectId("61471c3902fc0aff0ec40eff")},{"$ref":"test","$id":ObjectId("614718a602fc0aff0ec40ef8")}]})
WriteResult({ "nInserted" : 1 })
> db.orders.insert({"order_number":1112, "date":ISODate("2021-08-02"), "total_sum":1150, "customer":{"name":"Yekatierina", "surname":"Churakova", "phone_numbers":[132435, 687980], "address":"PTI, Peremohy ave. 27, Kyiv, UA"}, "payment":{"card_owner":"Yekatierina Churakova", "cardID":44444444}, "order_items_id":[{"$ref":"test", "$id":ObjectId("61471c3902fc0aff0ec40eff")},{"$ref":"test","$id":ObjectId("614718c902fc0aff0ec40ef9")}]})
WriteResult({ "nInserted" : 1 })
> db.orders.insert({"order_number":1113, "date":ISODate("2021-08-25"), "total_sum":850, "customer":{"name":"Cathrine", "surname":"Sidorenko", "phone_numbers":[987654, 456789], "address":"PTI, Peremohy ave. 27, Kyiv, UA"}, "payment":{"card_owner":"Cathrine Sidorenko", "cardID":33333333}, "order_items_id":[{"$ref":"test", "$id":ObjectId("61471c3902fc0aff0ec40eff")},{"$ref":"test","$id":ObjectId("61471b1402fc0aff0ec40efc")}]})
WriteResult({ "nInserted" : 1 })
> db.orders.insert({"order_number":1114, "date":ISODate("2021-09-11"), "total_sum":750, "customer":{"name":"Kate", "surname":"Soldatova", "phone_numbers":[564738, 384756], "address":"PTI, Peremohy ave. 27, Kyiv, UA"}, "payment":{"card_owner":"Kate Soldatova", "cardID":22222222}, "order_items_id":[{"$ref":"test", "$id":ObjectId("61471b7202fc0aff0ec40efd")},{"$ref":"test","$id":ObjectId("61471b1402fc0aff0ec40efc")}]})
WriteResult({ "nInserted" : 1 })

Task 2.2
> db.orders.find().pretty()
{
        "_id" : ObjectId("614746f202fc0aff0ec40f01"),
        "order_number" : 1111,
        "date" : ISODate("2021-06-18T00:00:00Z"),
        "total_sum" : 1000,
        "customer" : {
                "name" : "Katerina",
                "surname" : "Burbela",
                "phone_numbers" : [
                        102938,
                        19283
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Katerina Burbela",
                "cardID" : 11111111
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718a602fc0aff0ec40ef8"))
        ]
}
{
        "_id" : ObjectId("6147484102fc0aff0ec40f02"),
        "order_number" : 1112,
        "date" : ISODate("2021-08-02T00:00:00Z"),
        "total_sum" : 1150,
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Yekatierina Churakova",
                "cardID" : 44444444
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718c902fc0aff0ec40ef9"))
        ]
}
{
        "_id" : ObjectId("6147491902fc0aff0ec40f03"),
        "order_number" : 1113,
        "date" : ISODate("2021-08-25T00:00:00Z"),
        "total_sum" : 850,
        "customer" : {
                "name" : "Cathrine",
                "surname" : "Sidorenko",
                "phone_numbers" : [
                        987654,
                        456789
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Cathrine Sidorenko",
                "cardID" : 33333333
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("61471b1402fc0aff0ec40efc"))
        ]
}
{
        "_id" : ObjectId("61474aeb02fc0aff0ec40f04"),
        "order_number" : 1114,
        "date" : ISODate("2021-09-11T00:00:00Z"),
        "total_sum" : 750,
        "customer" : {
                "name" : "Kate",
                "surname" : "Soldatova",
                "phone_numbers" : [
                        564738,
                        384756
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Kate Soldatova",
                "cardID" : 22222222
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471b7202fc0aff0ec40efd")),
                DBRef("test", ObjectId("61471b1402fc0aff0ec40efc"))
        ]
}

Task 2.3
> db.orders.find({"total_sum":{$gte:1000}}).pretty()
{
        "_id" : ObjectId("614746f202fc0aff0ec40f01"),
        "order_number" : 1111,
        "date" : ISODate("2021-06-18T00:00:00Z"),
        "total_sum" : 1000,
        "customer" : {
                "name" : "Katerina",
                "surname" : "Burbela",
                "phone_numbers" : [
                        102938,
                        19283
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Katerina Burbela",
                "cardID" : 11111111
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718a602fc0aff0ec40ef8"))
        ]
}
{
        "_id" : ObjectId("6147484102fc0aff0ec40f02"),
        "order_number" : 1112,
        "date" : ISODate("2021-08-02T00:00:00Z"),
        "total_sum" : 1150,
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Yekatierina Churakova",
                "cardID" : 44444444
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718c902fc0aff0ec40ef9"))
        ]
}

Task 2.4
>db.orders.find({$and:[{"customer.name":"Yekatierina"}, {"customer.surname":"Churakova"}]}).pretty()
{
        "_id" : ObjectId("6147484102fc0aff0ec40f02"),
        "order_number" : 1112,
        "date" : ISODate("2021-08-02T00:00:00Z"),
        "total_sum" : 1150,
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Yekatierina Churakova",
                "cardID" : 44444444
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718c902fc0aff0ec40ef9"))
        ]
}

Task 2.5
> db.orders.find({"order_items_id.$id":ObjectId("61471c3902fc0aff0ec40eff")}).pretty()
{
        "_id" : ObjectId("614746f202fc0aff0ec40f01"),
        "order_number" : 1111,
        "date" : ISODate("2021-06-18T00:00:00Z"),
        "total_sum" : 1000,
        "customer" : {
                "name" : "Katerina",
                "surname" : "Burbela",
                "phone_numbers" : [
                        102938,
                        19283
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Katerina Burbela",
                "cardID" : 11111111
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718a602fc0aff0ec40ef8"))
        ]
}
{
        "_id" : ObjectId("6147484102fc0aff0ec40f02"),
        "order_number" : 1112,
        "date" : ISODate("2021-08-02T00:00:00Z"),
        "total_sum" : 1150,
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Yekatierina Churakova",
                "cardID" : 44444444
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718c902fc0aff0ec40ef9"))
        ]
}
{
        "_id" : ObjectId("6147491902fc0aff0ec40f03"),
        "order_number" : 1113,
        "date" : ISODate("2021-08-25T00:00:00Z"),
        "total_sum" : 850,
        "customer" : {
                "name" : "Cathrine",
                "surname" : "Sidorenko",
                "phone_numbers" : [
                        987654,
                        456789
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Cathrine Sidorenko",
                "cardID" : 33333333
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("61471b1402fc0aff0ec40efc"))
        ]
}

Task 2.6
>db.orders.findAndModify({query:{"order_items_id.$id":ObjectId("61471c3902fc0aff0ec40eff")}, update:{$push:{"order_items_id":{"$ref":"test","$id":ObjectId("61471c5b02fc0aff0ec40f00")}}},})
>db.orders.updateMany({"order_items_id.$id":ObjectId("61471c5b02fc0aff0ec40f00")},{$inc:{"total_sum":250}})
{ "acknowledged" : true, "matchedCount" : 3, "modifiedCount" : 3 }

Task 2.7
>db.orders.aggregate([{$match:{"order_number":1112}},{$group:{_id:"$order_number",count:{$sum:{$size:"$order_items_id"}}}}])
{ "_id" : 1112, "count" : 3 }db

Task 2.8
> db.orders.find({total_sum: {$gt:1000}}, {_id:0, "order_number":0, "date":0, "total_sum":0, "order_items_id":0}).pretty()
{
        "customer" : {
                "name" : "Katerina",
                "surname" : "Burbela",
                "phone_numbers" : [
                        102938,
                        19283
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Katerina Burbela",
                "cardID" : 11111111
        }
}
{
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Yekatierina Churakova",
                "cardID" : 44444444
        }
}
{
        "customer" : {
                "name" : "Cathrine",
                "surname" : "Sidorenko",
                "phone_numbers" : [
                        987654,
                        456789
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Cathrine Sidorenko",
                "cardID" : 33333333
        }
}

Task 2.9
>db.orders.findAndModify({query:{"date":{$gte:ISODate("2021-08-25")}}, update:{$pull:{"order_items_id":{"$ref":"test","$id":ObjectId("61471b1402fc0aff0ec40efc")}}},})
{
        "_id" : ObjectId("614836c26e8585c6b09db180"),
        "order_number" : 1113,
        "date" : ISODate("2021-08-25T00:00:00Z"),
        "total_sum" : 1100,
        "customer" : {
                "name" : "Cathrine",
                "surname" : "Sidorenko",
                "phone_numbers" : [
                        987654,
                        456789
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "payment" : {
                "card_owner" : "Cathrine Sidorenko",
                "cardID" : 33333333
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("61471b1402fc0aff0ec40efc")),
                DBRef("test", ObjectId("61471c5b02fc0aff0ec40f00"))
        ]
}

Task 2.10
> db.orders.updateMany({},{$set:{"customer.name":"Ekaterina"}})
{ "acknowledged" : true, "matchedCount" : 4, "modifiedCount" : 4 }
>  db.orders.find({},{_id:0, "order_number":0, "date":0, "total_sum":0, "order_items_id":0, "payment":0}).pretty()
{
        "customer" : {
                "name" : "Ekaterina",
                "surname" : "Burbela",
                "phone_numbers" : [
                        102938,
                        19283
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        }
}
{
        "customer" : {
                "name" : "Ekaterina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        }
}
{
        "customer" : {
                "name" : "Ekaterina",
                "surname" : "Sidorenko",
                "phone_numbers" : [
                        987654,
                        456789
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        }
}
{
        "customer" : {
                "name" : "Ekaterina",
                "surname" : "Soldatova",
                "phone_numbers" : [
                        564738,
                        384756
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        }
}

Task 2.11
>db.orders.aggregate([{$match:{"customer.surname":"Churakova"}},{$lookup:{"from":"test","localField":"order_items_id.$id","foreignField":"_id",'as':"product_info"}},{$project:{"_id":0,"order_number":0,"date":0,"total_sum":0,"payment":0}}]).pretty()
{
        "customer" : {
                "name" : "Yekatierina",
                "surname" : "Churakova",
                "phone_numbers" : [
                        132435,
                        687980
                ],
                "address" : "PTI, Peremohy ave. 27, Kyiv, UA"
        },
        "order_items_id" : [
                DBRef("test", ObjectId("61471c3902fc0aff0ec40eff")),
                DBRef("test", ObjectId("614718c902fc0aff0ec40ef9")),
                DBRef("test", ObjectId("61471c5b02fc0aff0ec40f00"))
        ],
        "product_info" : [
                {
                        "_id" : ObjectId("614718c902fc0aff0ec40ef9"),
                        "category" : "Smartphone",
                        "model" : "Galaxy Fold",
                        "producer" : "Samsung",
                        "price" : 750,
                        "diagonal" : 6
                },
                {
                        "_id" : ObjectId("61471c3902fc0aff0ec40eff"),
                        "category" : "Smart Watch",
                        "model" : "Series 6",
                        "producer" : "Apple",
                        "color" : "blue",
                        "price" : 400
                },
                {
                        "_id" : ObjectId("61471c5b02fc0aff0ec40f00"),
                        "category" : "Smart Watch",
                        "model" : "Fit",
                        "producer" : "Huawei",
                        "color" : "pink",
                        "price" : 300
                }
        ]
}
